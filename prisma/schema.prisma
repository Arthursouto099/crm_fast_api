// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client"
  output   = "../generated"
}

datasource db {
  provider = "postgresql"
}

enum Roles {
  ADM
  OWNER
  COLABORADOR
  USUARIO
}

enum TypePlan {
  GRATIS
  BASICO
  AVANCADO
}



model User {
  id_user  String @id @default(uuid())
  name     String
  role     Roles  @default(USUARIO)
  email    String @unique
  password String
  profile_image String @default("")
  typePlan TypePlan @default(GRATIS)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt 
  store Store[]
  movement_stocks MovementStock[]
}


model Store {
  id_store String @id @default(uuid())
  id_owner String
  store_name String 
  owner User @relation(fields: [id_owner], references: [id_user], onDelete: Cascade)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  store_image String?
  logo String?
  store_bio String?
  products Product[]
  movements_stocks MovementStock[]
  customers Customer[]
}


enum typeMovement {
  AJUSTE
  SAIDA
  ENTRADA
}

model MovementStock {
  id_movementStock String @id @default(uuid())
  id_store String 
  id_user String
  id_product String
  createdAt DateTime @default(now())
  quantity Int
  typeMovement typeMovement @default(ENTRADA)
  store Store @relation(fields: [id_store], references: [id_store])
  user User @relation(fields: [id_user], references: [id_user]) 
  product Product @relation(fields: [id_product], references: [id_product])

}


model Product {
  id_product String @id @default(uuid())
  id_store String
  store Store @relation(fields: [id_store], references: [id_store], onDelete: Cascade)
  product_name String
  product_description String 
  product_price Decimal @db.Decimal(10, 2)
  sizeMl Int?
  product_image String?
  stock_quantity Int @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt 
  category String @default("Produto")
  // quando tiver apenas n unidades, alertar de reposição
  low_stock_at Int?
  movement_stocks MovementStock[]
}


enum TypeCustomer {
  PF
  PJ
}


model Customer {
  id_customer       String @id @default(uuid())
  name_customer     String
  type              TypeCustomer
  document_customer String
  email_customer    String?
  phone_customer    String?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  active            Boolean @default(true)

  id_store          String
  store             Store   @relation(fields: [id_store], references: [id_store])

  // Endereço principal (opcional)
  id_address        String? @unique 
  mainAddress       CustomerAddress? @relation("CustomerMainAddress", fields: [id_address], references: [id_customerAddress], onDelete: SetNull)

  // Lista de endereços
  addresses         CustomerAddress[] @relation("CustomerAddresses")
}

model CustomerAddress {
  id_customerAddress String @id @default(uuid())

  id_customer        String
  customer           Customer @relation("CustomerAddresses", fields: [id_customer], references: [id_customer], onDelete: Cascade)

  cep                String
  isDefault          Boolean @default(false)
  street             String
  number             String
  complement         String?
  city               String
  state              String
  country            String

  mainOfCustomer Customer? @relation("CustomerMainAddress")  
}